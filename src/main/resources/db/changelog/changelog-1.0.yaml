databaseChangeLog:
  - changeSet:
      id: 1
      author: JakubPavlicek
      changes:

        # ENABLE uuid_generate_v4() FUNCTION

        - sql:
            sql: "CREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";"

        # TABLES

        - createTable:
            tableName: movie
            columns:
              - column:
                  name: movie_id
                  type: varchar(255)
                  defaultValueComputed: uuid_generate_v4()
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: name
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: release_date
                  type: date
                  constraints:
                    nullable: false
              - column:
                  name: duration
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: clob
                  constraints:
                    nullable: false
              - column:
                  name: director_id
                  type: varchar(255)
                  constraints:
                    nullable: true
                    foreignKeyName: fk_director
              - column:
                  name: rating
                  type: double
                  defaultValueNumeric: '0.0'
                  constraints:
                    nullable: false
              - column:
                  name: review_count
                  type: int
                  defaultValueNumeric: '0'
                  constraints:
                    nullable: false
              - column:
                  name: poster_url
                  type: clob
                  constraints:
                    nullable: false
              - column:
                  name: trailer_url
                  type: clob
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: timestamp
                  constraints:
                    nullable: false

        - createTable:
            tableName: country
            columns:
              - column:
                  name: country_id
                  type: varchar(255)
                  defaultValueComputed: uuid_generate_v4()
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: name
                  type: varchar(15)
                  constraints:
                    nullable: false
                    unique: true

        - createTable:
            tableName: genre
            columns:
              - column:
                  name: genre_id
                  type: varchar(255)
                  defaultValueComputed: uuid_generate_v4()
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: name
                  type: varchar(15)
                  constraints:
                    nullable: false
                    unique: true

        - createTable:
            tableName: production_company
            columns:
              - column:
                  name: company_id
                  type: varchar(255)
                  defaultValueComputed: uuid_generate_v4()
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: name
                  type: varchar(100)
                  constraints:
                    nullable: false
                    unique: true

        - createTable:
            tableName: actor
            columns:
              - column:
                  name: actor_id
                  type: varchar(255)
                  defaultValueComputed: uuid_generate_v4()
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: name
                  type: varchar(50)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: bio
                  type: clob
                  constraints:
                    nullable: true
              - column:
                  name: gender_id
                  type: varchar(255)
                  constraints:
                    nullable: false
                    foreignKeyName: fk_gender

        - createTable:
            tableName: director
            columns:
              - column:
                  name: director_id
                  type: varchar(255)
                  defaultValueComputed: uuid_generate_v4()
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: name
                  type: varchar(50)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: bio
                  type: clob
                  constraints:
                    nullable: true
              - column:
                  name: gender_id
                  type: varchar(255)
                  constraints:
                    nullable: false
                    foreignKeyName: fk_gender

        - createTable:
            tableName: gender
            columns:
              - column:
                  name: gender_id
                  type: varchar(255)
                  defaultValueComputed: uuid_generate_v4()
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: name
                  type: varchar(15)
                  defaultValue: 'Unspecified'
                  constraints:
                    nullable: false
                    unique: true

        # JOIN TABLES

        - createTable:
            tableName: movie_country
            columns:
              - column:
                  name: movie_id
                  type: varchar(255)
                  constraints:
                    nullable: false
                    foreignKeyName: fk_movie
              - column:
                  name: country_id
                  type: varchar(255)
                  constraints:
                    nullable: false
                    foreignKeyName: fk_country

        - createTable:
            tableName: movie_genre
            columns:
              - column:
                  name: movie_id
                  type: varchar(255)
                  constraints:
                    nullable: false
                    foreignKeyName: fk_movie
              - column:
                  name: genre_id
                  type: varchar(255)
                  constraints:
                    nullable: false
                    foreignKeyName: fk_genre

        - createTable:
            tableName: movie_production
            columns:
              - column:
                  name: movie_id
                  type: varchar(255)
                  constraints:
                    nullable: false
                    foreignKeyName: fk_movie
              - column:
                  name: company_id
                  type: varchar(255)
                  constraints:
                    nullable: false
                    foreignKeyName: fk_company

        - createTable:
            tableName: movie_cast
            columns:
              - column:
                  name: movie_cast_id
                  type: varchar(255)
                  defaultValueComputed: uuid_generate_v4()
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: movie_id
                  type: varchar(255)
                  constraints:
                    nullable: false
                    foreignKeyName: fk_movie
              - column:
                  name: actor_id
                  type: varchar(255)
                  constraints:
                    nullable: false
                    foreignKeyName: fk_actor
              - column:
                  name: role
                  type: varchar(100)
                  constraints:
                    nullable: false

        # FOREIGN KEYS

        - addForeignKeyConstraint:
            baseTableName: movie
            baseColumnNames: director_id
            constraintName: fk_director
            referencedTableName: director
            referencedColumnNames: director_id

        - addForeignKeyConstraint:
            baseTableName: movie_country
            baseColumnNames: movie_id
            constraintName: fk_movie
            referencedTableName: movie
            referencedColumnNames: movie_id

        - addForeignKeyConstraint:
            baseTableName: movie_country
            baseColumnNames: country_id
            constraintName: fk_country
            referencedTableName: country
            referencedColumnNames: country_id

        - addForeignKeyConstraint:
            baseTableName: movie_genre
            baseColumnNames: movie_id
            constraintName: fk_movie
            referencedTableName: movie
            referencedColumnNames: movie_id

        - addForeignKeyConstraint:
            baseTableName: movie_genre
            baseColumnNames: genre_id
            constraintName: fk_genre
            referencedTableName: genre
            referencedColumnNames: genre_id

        - addForeignKeyConstraint:
            baseTableName: movie_production
            baseColumnNames: movie_id
            constraintName: fk_movie
            referencedTableName: movie
            referencedColumnNames: movie_id

        - addForeignKeyConstraint:
            baseTableName: movie_production
            baseColumnNames: company_id
            constraintName: fk_company
            referencedTableName: production_company
            referencedColumnNames: company_id

        - addForeignKeyConstraint:
            baseTableName: movie_cast
            baseColumnNames: movie_id
            constraintName: fk_movie
            referencedTableName: movie
            referencedColumnNames: movie_id

        - addForeignKeyConstraint:
            baseTableName: movie_cast
            baseColumnNames: actor_id
            constraintName: fk_actor
            referencedTableName: actor
            referencedColumnNames: actor_id

  # INSERT DATA

  - changeSet:
      id: 2
      author: JakubPavlicek
      changes:

        # INSERT GENRES

        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Action'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Adventure'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Animation'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Biography'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Comedy'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Crime'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Documentary'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Drama'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Family'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Fantasy'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Film-Noir'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'History'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Horror'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Music'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Musical'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Mystery'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Romance'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Sci-Fi'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Sport'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Superhero'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Thriller'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'War'
        - insert:
            tableName: genre
            columns:
              - column:
                  name: name
                  value: 'Western'

        # INSERT COUNTRIES

        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'United States'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Canada'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'United Kingdom'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Australia'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Germany'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'France'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Italy'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Spain'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Japan'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'China'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'India'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Brazil'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Russia'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Mexico'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'South Korea'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'South Africa'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Netherlands'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Sweden'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Norway'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Denmark'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Finland'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'New Zealand'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Argentina'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Belgium'
        - insert:
            tableName: country
            columns:
              - column:
                  name: name
                  value: 'Switzerland'

        # INSERT COUNTRIES

        - insert:
            tableName: gender
            columns:
              - column:
                  name: name
                  value: 'Unspecified'

        - insert:
            tableName: gender
            columns:
              - column:
                  name: name
                  value: 'Male'

        - insert:
            tableName: gender
            columns:
              - column:
                  name: name
                  value: 'Female'

        - insert:
            tableName: gender
            columns:
              - column:
                  name: name
                  value: 'Non-binary'